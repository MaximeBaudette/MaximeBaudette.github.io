name: Deploy site

on:
  push:
    branches:
      - new_style
    paths:
      - "assets/**"
      - "_sass/**"
      - "_scripts/**"
      - "**.bib"
      - "**.html"
      - "**.js"
      - "**.liquid"
      - "**/*.md"
      - "**.yml"
      - "Gemfile"
      - "Gemfile.lock"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Setup Ruby ğŸ’
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "3.3.5"
          bundler-cache: true

      - name: Setup Python ğŸ
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Download icon fonts ğŸ”¤
        run: |
          FA_VERSION="6.7.1"
          TI_VERSION="3.20.0"
          # Font Awesome 6 Free â€” goes into assets/webfonts/ (default $fa-font-path)
          mkdir -p assets/webfonts
          for f in fa-brands-400 fa-regular-400 fa-solid-900; do
            curl -sfL "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/${FA_VERSION}/webfonts/${f}.woff2" -o "assets/webfonts/${f}.woff2"
            curl -sfL "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/${FA_VERSION}/webfonts/${f}.ttf"   -o "assets/webfonts/${f}.ttf"
          done
          # Tabler Icons â€” goes into assets/fonts/ ($ti-font-path overridden in main.scss)
          for f in tabler-icons.woff2 tabler-icons.woff tabler-icons.ttf; do
            curl -sfL "https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@${TI_VERSION}/dist/fonts/${f}" -o "assets/fonts/${f}"
          done

      - name: Install and Build ğŸ”§
        run: |
          pip3 install --upgrade nbconvert
          export JEKYLL_ENV=production
          bundle exec jekyll build

      - name: Purge unused CSS ğŸ§¹
        run: |
          npm install -g purgecss
          purgecss -c purgecss.config.js

      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: _site
